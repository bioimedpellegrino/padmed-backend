{% extends 'layouts/base-triage.html' %}

{% block title %} Receptions {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}
{% block content %}
    <!-- Header container -->
    <div class="container" style="background-color: #00a99d">
        <div class="row">
          <div class="col-md-1">
          </div>
          <div class="col-md-1">
          </div>
          <div class="col-md-1">
            <i class="fas fa-arrow-right"></i>
          </div>
            <div class="col-md-6">
               <p style="color: white;"><b>PRIMA DI UTILIZZARE IL SERVIZIO ACCETTARE LE CONDIZIONI</b></p>
            </div>
            <div class="col-md-1">
              <i class="fas fa-arrow-left"></i>
            </div>
            <div class="col-md-1">
            </div>
            <div class="col-md-1">
            </div>
        </div>
    </div>
    <!-- Header container -->
<button id="scanButton">Scan</button>
<button id="writeButton">Scan</button>
<p id="output"></p>
<p id="devices"></p>

<h1>
  print me
  </h1>
  <button onclick="window.print();">
  Print Me
  </button>


  <a onclick="sendToQuickPrinterChrome();">
    <br>Print Button</a>
<!-- Specific JS goes HERE --> 
{% block javascripts %}

<script>
  //onScan.attachTo(document);
// Register event listener
try{
  onScan.attachTo(document, {
    suffixKeyCodes: [13], // enter-key expected at the end of a scan
    reactToPaste: true, // Compatibility to built-in scanners in paste-mode (as opposed to keyboard-mode)
    onScan: function(sCode, iQty) { // Alternative to document.addEventListener('scan')
        document.getElementById("output").innerHTML = 'Scanned: ' + iQty + 'x ' + sCode; 
    },
    onKeyDetect: function(iKeyCode){ // output all potentially relevant key events - great for debugging!
      document.getElementById("output").innerHTML = 'Pressed: ' + iKeyCode;
    }
});
} catch(err){
  //document.getElementById("output").innerHTML = err + " " + err.message;
}
  function sendToQuickPrinterChrome(){
    var commandsToPrint =
                 "<LOGO>" +
                         "<BIG><BOLD><CENTER> CAZZO <BR>\n" +
                         "<CENTER>Bubino<BR>\n" +
                         "<CENTER>Il bubino<BR>\n" +
                         "<BOLD>Bay<BR>\n" +
                         "<LEFT>Che va<BR>\n" +
                         "<RIGHT><BOLD>A MUMBAII<BR>\n" +
                         "<BR>\n" +
                         "<CUT>\n" +
                         "<DRAWER>\n" // OPEN THE CASH DRAWER
                 ;
     var textEncoded = encodeURI(commandsToPrint);
     window.location.href="intent://"+textEncoded+"#Intent;scheme=quickprinter;package=pe.diegoveloper.printerserverapp;end;";
 }


 var keybuffer = [];

function press(event) {
  console.log("pressed");
  if (event.which === 13) {
    return send();
  }
  var number = event.which - 48;
  if (number < 0 || number > 9) {
    return;
  }
  keybuffer.push(number);
}

$(document).on("keypress", press);

  function send() {
    console.log("scanned ");
    socket.emit('scan', keybuffer.join(""));
    keybuffer.length = 0;
  }


  var RFIDTime = false;
  var RFIDInput = "";
  $(document).keyup(function(e){
  if(!RFIDTime) RFIDInput += String.fromCharCode(e.which); RFIDTime = e.timeStamp;
  
  if(RFIDTime){
  if(e.timeStamp RFIDTime < 20){
  RFIDInput += String.fromCharCode(e.which);
  RFIDTime = e.timeStamp;
  if(RFIDInput.length == 10){
  console.log('detected RFID, value:' + RFIDInput);
  }
  } else {
  RFIDInput = "";
  RFIDTime = false;
  }
  }
  });
</script>
{% endblock javascripts %}
{% endblock content %}
